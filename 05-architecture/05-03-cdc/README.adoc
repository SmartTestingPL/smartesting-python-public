= Testowanie kontraktowe

Modu 05-03-01 to producent wiadomoci, za 05-03-02 jego konsument.

Zar贸wno konsument, jak i producent mog by napisani w r贸偶nych jzykach i technologiach.

Pokazujemy dwa r贸偶ne narzdzia i dwa r贸偶ne flow contract testingu.

== a) z u偶yciem Spring Cloud Contracts

Teraz u偶yjemy flow od strony producenta - do istniejcego napiszemy kontrakty, zweryfikujemy je i wygenerujemy stuby, by potem napisa klienta u偶ywajc tych ostatnich.

=== Po stronie producenta
1. Piszemy kontrakt(y) (`05-architecture/05-03-cdc/05-03-01-producer/contracts`)
2. Uruchamiamy aplikacj (patrz na samym dole)
3. Uruchamiamy Spring Cloud Contracts w dockerze (`01_generate_stubs_with_scc.sh`)
4. Cieszymy si z weryfikacji kontrakt贸w i wygenerowanych stub贸w :) (`spring-cloud-contract-output/libs/smarttesting-0.0.1.RELEASE-stubs.jar`)

UWAGA: W tym przykadzie nie wykorzystujemy 偶adnego repozytorium na stuby jak Artifactory. Wicej informacji w dokumentacji Spring Cloud Contracts: https://docs.spring.io/spring-cloud-contract/docs/current/reference/html/docker-project.html#docker-how-it-works

=== Po stronie konsumenta

1. Najpierw uruchamiamy stubrunnera, kt贸ry stawia nam i konfiguruje Wiremocka dla sprawdzonych kontrakt贸w (`02_run_stubrunner.sh`)
2. Potem mo偶emy tradycyjnie uruchomi testy `pytest 05-architecture/05-03-cdc/05-03-02-consumer`

== b) z u偶yciem Pact

Teraz u偶yjemy flow od strony klienta - tak zwane Consumer-Driven Contract Testing (no prawie, bo usuga weryfikacji ju偶 istnieje )

=== Po stronie konsumenta

1. Uruchamiamy testy `pytest 05-architecture/05-03-cdc/05-03-02-consumer/consumer/consumer_pact_tests.py`
2. Testy wygeneroway nam plik .json `some_consumer_fraudverify.json` (jest ju偶 w repo)

=== Po stronie producenta

1. Uruchamiamy aplikacj producenta (patrz ni偶ej)
A. Albo weryfikujemy serwer u偶ywajac wbudowanego narzdzia CLI `pact-verifier --provider-base-url="http://localhost:5050/" --pact-url=05-architecture/05-03-cdc/05-03-02-consumer/consumer/some_consumer-fraudverify.json`
B. Albo piszemy test u偶ywajac Python API, np. opakowaujc to w pytest https://github.com/pact-foundation/pact-python#python-api

== Uruchamianie aplikacji:
```bash
cd 05-architecture/05-03-cdc/05-03-01-producer/
APP_ENV=DEV FLASK_APP=smarttesting_api.web_app:app flask run --port 5050
```
